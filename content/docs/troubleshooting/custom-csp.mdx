---
title: Custom Content Security Policy (CSP)
description: Configure custom Content Security Policy settings to allow GitButler connections to self-hosted GitHub, GitLab, or Ollama instances.
---

import { Callout } from 'fumadocs-ui/components/callout';
import { Tab, Tabs } from 'fumadocs-ui/components/tabs';

By default GitButler uses a strict Content Security Policy (CSP) to protect against various attacks, such as cross-site scripting (XSS) and data injection attacks. This policy restricts the sources from which content can be loaded, as well as the hosts the application can connect to, ensuring that only trusted sources are allowed.

However, there are some cases where you may need to customize the CSP to allow certain features or integrations. Some examples include:
- Self-hosted GitHub Enterprise instances
- Self-hosted GitLab instances
- Self-hosted Ollama instances

In those cases you are likely to observe an error message that looks something like this:

```
Refused to connect to https://<YOURDOMAIN>.<TLD>/api/v4/projects/9/merge_requests because it does not appear in the connect-src directive of the Content Security Policy.
```

You can resolve this issue by adding your host to the CSP. 

## Adding a Custom CSP

You can add a custom CSP by editing the GitButler configuration file, found at the following location:

<Tabs groupId="platform" items={['macOS', 'Windows', 'Linux']} persist>
  <Tab value="macOS">
  ```bash
  ~/Library/Application\ Support/gitbutler/settings.json
  ```
  </Tab>
  <Tab value="Windows">
  ```bash
  C:\Users\[username]\AppData\Roaming\gitbutler\settings.json
  ```
  </Tab>
  <Tab value="Linux">
  ```bash
  ~/.config/gitbutler/settings.json
  ```
  </Tab>
</Tabs>

The file is in JSONC format and follows the [following schema](https://github.com/gitbutlerapp/gitbutler/blob/master/crates/but-settings/assets/defaults.jsonc)

In order to add your custom CSP entry, you want to add an `extraCsp` entry to the JSON file. The `extraCsp` entry is an object that contains a `hosts` array, which is where you can add your custom hosts. For example:

```json
"extraCsp": {
  "hosts": ["https://subdomain.example.com", "http://another-subdomain.example.com"]
}
```

Note that if `extraCsp` is the only entry in the JSON file, you may want to enclose it in a top-level object, like this:

```json
{
  "extraCsp": {
    "hosts": ["https://subdomain.example.com", "http://another-subdomain.example.com"]
  }
}
```

The changes will take effect the next time you start GitButler.

## Connecting to HTTP instances

If you are trying to connect to a self-hosted instance served over plain HTTP, you may find that GitButler cannot reach it even with the correct CSP configuration. This is because WebKit (used by GitButler on macOS) blocks insecure HTTP requests from applications. Other platforms may exhibit similar behavior depending on their WebView implementation.

<Callout type="info">
  This only affects instances served over plain HTTP. If your self-hosted instance already uses HTTPS, you can skip this section.
</Callout>

As a workaround, you can run a local HTTPS reverse proxy using [Caddy](https://caddyserver.com). Caddy automatically generates a locally-trusted TLS certificate, so GitButler sees a secure connection while your self-hosted instance continues to run over HTTP.

### Setting up Caddy as a local HTTPS proxy

The following example uses [Homebrew](https://brew.sh) on macOS, but the same approach works on any platform where Caddy is available.

1. Install Caddy:

```sh
brew install caddy
```

2. Create a `Caddyfile` (for example in `~/.config/caddy/Caddyfile`):

```caddyfile
https://127.0.0.1:PORT {
    tls internal

    reverse_proxy http://YOUR_INSTANCE:PORT {
        header_up Host YOUR_INSTANCE_HOSTNAME
    }
}
```

Replace `YOUR_INSTANCE` and `PORT` with the hostname and port of your self-hosted instance. The `header_up Host` directive ensures the original `Host` header is forwarded correctly.

3. Start Caddy:

```sh
caddy run --config ~/.config/caddy/Caddyfile
```

4. In GitButler, set your forge URL to `https://127.0.0.1:PORT` (matching the port from your Caddyfile) instead of the original HTTP URL.

Your self-hosted instance should now be accessible through the local HTTPS proxy.
